#!/bin/bash

git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
mkdir -p $HOME/.rbenv/plugins
cd $HOME/.rbenv/plugins
git clone https://github.com/sstephenson/ruby-build.git
git clone https://github.com/sstephenson/rbenv-gem-rehash.git
git clone https://github.com/tpope/rbenv-ctags.git
git clone https://github.com/sstephenson/rbenv-default-gems.git
git clone https://github.com/ianheggie/rbenv-binstubs.git
sudo $HOME/.rbenv/plugins/ruby-build/install.sh
export PATH=$PATH:$HOME/.rbenv/bin
rbenv init - zsh

ln -s $HOME/dotfiles/default-gems $HOME/.rbenv/default-gems

case "${OSTYPE}" in
darwin*)
  [[ -x `whence -p brew` ]] && brew install openssl readline
  # 1.9.3
  CONFIGURE_OPTS="--with-openssl-dir=`brew --prefix openssl` --with-readline-dir=`brew --prefix openssl` --enable-shared" rbenv install 1.9.3-p484
  # 2.0.0
  RUBY_CONFIGURE_OPTS="--with-openssl-dir=`brew --prefix openssl` --with-readline-dir=`brew --prefix openssl` --enable-shared" rbenv install 2.0.0-p353
  # 2.1.0
  RUBY_CONFIGURE_OPTS="--with-openssl-dir=`brew --prefix openssl` --with-readline-dir=`brew --prefix openssl` --enable-shared" rbenv install 2.1.0
  ;;
linux*)
  # 1.9.3
  CONFIGURE_OPTS="--with-openssl-dir=/usr --with-readline-dir=/usr/include/readline --enable-shared" rbenv install 1.9.3-p484
  # 2.0.0
  RUBY_CONFIGURE_OPTS="--with-openssl-dir=/usr --with-readline-dir=/usr/include/readline --enable-shared" rbenv install 2.0.0-p353
  # 2.1.0
  RUBY_CONFIGURE_OPTS="--with-openssl-dir=/usr --with-readline-dir=/usr/include/readline --enable-shared" rbenv install 2.1.0
  ;;
esac

rbenv global 2.1.0
rbenv rehash
export PATH=$HOME/.rbenv/shims:$PATH
